/*! Logic 20-03-2015 */
function logPlay(){_gaq.push(["_trackEvent","Button","Play"])}function moveModal(){var a=$(".modal"),b=$(app.canvas).offset();a.offset({top:b.top-5,left:b.left-5})}function replaceAt(a,b,c){return a.substr(0,b)+c+a.substr(b+c.length)}function start(){new Date;window.app=new SL.Game({canvas:document.getElementById("GameCanvas")}),app.assetCollection=new SL.AssetCollection("res/assets.json",app,function(){var a=new SL.Scene("loading",[],function(){},app);a.addEntity(new SL.Loader({assetCollection:app.assetCollection,screenSize:SCREEN_SIZE,loadCallback:function(){app.transitionScene("game")},barColor:"blue",textColor:"green"}));var b=new SL.Scene("game",[],function(){app.currentScene.addEntity({type:"background",sprite:new PIXI.Sprite(app.assetCollection.getTexture("background")),update:function(){for(;app.currentScene.getEntitiesByTag("food").length<5;)app.currentScene.addEntity(new Food({position:(new SCREEN_SIZE.clone).randomize()}));for(;app.currentScene.getEntitiesByTag("creature").length<150;)app.currentScene.addEntity(new Creature({position:(new SCREEN_SIZE.clone).randomize(),inputs:["radarFood","radarEdge"],logicCircuit:seedCircuit({inputs:8,outputs:4,genomeLength:64})}))}})},app);app.addScene(a),app.addScene(b),app.transitionScene("loading"),app.start()})}function Creature(a){function b(){for(var a=[],b=app.currentScene.getEntitiesByTag("food"),d=!1,e=0;e<c.inputs.length;e++)if(d=!1,"radarFood"===c.inputs[e]){for(var f=0;f<b.length;f++)if(c.sprite.position.distance(b[f].sprite.position)<=25){d=!0,c.sprite.position.x>b[f].sprite.position.x?a.push(0,1):a.push(1,0),c.sprite.position.y>b[f].sprite.position.y?a.push(0,1):a.push(1,0);break}d?null:a.push(0,0,0,0)}else"radarEdge"===c.inputs[e]&&(a.push(c.sprite.position.x<=15?1:0),a.push(c.sprite.position.x>=SCREEN_SIZE.x-15?1:0),a.push(c.sprite.position.y<=15?1:0),a.push(c.sprite.position.y>=SCREEN_SIZE.y-15?1:0));return a}var c=this;c.tag="creature",c.health=10,c.sprite=new PIXI.Sprite(app.assetCollection.getTexture(c.tag)),c.sprite.anchor.x=.5,c.sprite.anchor.y=.5,c.sprite.position=a.position,c.sprite.rotation=0,c.inputs=a.inputs,c.logicCircuit=a.logicCircuit,c.update=function(){var a,d;if(c.health>=0){c.logicCircuit.input=b(),d=app.currentScene.getEntitiesByTag("food"),a=c.logicCircuit.resolve(),a[0]&&(c.sprite.position.x+=125*app.deltaTime),a[1]&&(c.sprite.position.x-=125*app.deltaTime),a[2]&&(c.sprite.position.y+=125*app.deltaTime),a[3]&&(c.sprite.position.y-=125*app.deltaTime),(c.sprite.position.x<=0||c.sprite.position.x>=app.screenSize.x||c.sprite.position.y<=0||c.sprite.position.y>=app.screenSize.y)&&(c.health=0),c.health-=app.deltaTime;for(var e=0;e<d.length;e++)c.sprite.position.distance(d[e].sprite.position)<=15&&(c.health+=10,d[e].eaten=!0)}else app.currentScene.removeEntity(c)}}function Food(a){var b=this;b.tag="food",b.sprite=new PIXI.Sprite(app.assetCollection.getTexture(b.tag)),b.sprite.anchor.x=.5,b.sprite.anchor.y=.5,b.sprite.position=a.position,b.sprite.rotation=0,b.eaten=!1,b.update=function(){b.eaten&&app.currentScene.removeEntity(b)}}function LogicGate(a){var b=this;b.tag="gate",b.type=a.type,b.sources=[],b.circuit=a.circuit,b.out=0,b.resolve=function(){var a="gate"===b.sources[0].tag?b.sources[0].out:b.circuit.input[b.sources[0]],c="gate"===b.sources[1].tag?b.sources[1].out:b.circuit.input[b.sources[1]];switch(b.type){case"AND":b.out=a&&c?1:0;break;case"OR":b.out=a||c?1:0;break;case"NOT":b.out=a?0:1;break;case"NAND":b.out=a&&c?0:1;break;case"NOR":b.out=a||c?0:1;break;case"XOR":b.out=!a&&!c||a&&c?0:1;break;default:b.out=0}}}function LogicCircuit(a){var b=this;b.genome=a,b.gates=[],b.gateTypes=["AND","OR","NOT","NAND","NOR","XOR"],b.input=[],b.outputs=[];for(var c=0;c<b.genome.length;c++)b.gates.push(new LogicGate({type:b.gateTypes[parseInt(b.genome[c])],circuit:b}));b.addOutput=function(a){b.outputs.push(b.gates[a])},b.setOutputs=function(a){b.outputs=[];for(var c=0;c<a.length;c++)b.outputs.push(b.gates[a[c]])},b.resolve=function(a){var d=[];for(b.input=a?a:b.input,c=0;c<b.gates.length;c++)b.gates[c].resolve();for(c=0;c<b.outputs.length;c++)d.push(b.outputs[c].out);return d}}function seedCircuit(a){for(var b,c,d=a.inputs,e=a.outputs,f=a.genomeLength,g="",h={},i=!1,j=0;f>j;j++)g+=Math.floor(6*Math.random());c=new LogicCircuit(g);for(var j=0;d>j;j++){for(;!i;)b=Math.floor(Math.random()*f),c.gates[b].sources[0]||(c.gates[b].sources[0]=j,i=!0);i=!1,c.input.push(0)}for(j=0;e>j;j++){for(;!i;)b=Math.floor(Math.random()*f),h[b]||(c.addOutput(b),h[b]=!0,i=!0);i=!1}for(j=0;f>j;j++){for(;!c.gates[j].sources[0];)b=Math.floor(Math.random()*f),b!==j&&(c.gates[j].sources[0]=c.gates[b]);for(;!c.gates[j].sources[1];)b=Math.floor(Math.random()*f),b!==j&&(c.gates[j].sources[1]=c.gates[b])}return c}function Evolver(){var a=this;a.data=[[[1,0],[0,0],[1,1],[0,1],[1,1],[1,1],[1,0],[0,0],[0,0],[0,1]],[[1,1],[1,0],[1,1],[0,0],[1,1],[0,1],[1,1],[0,0],[1,1],[1,1]]],a.expects=[1,0],a.generation=0,a.mutationRate=.01,a.generationSize=100,a.lastBestGenome="0112115320014113121231154123121354151321003511541123132045211231451232005141541321315205111424510315",a.lastBestFitness=1,a.update=function(){var b=[],c=a.lastBestFitness,d=a.lastBestGenome,e=[0,0];if(0!==a.lastBestFitness){for(var f=0;f<a.generationSize;f++)b.push(new LogicCircuit(a.generateGenome())),e[0]=b[f].resolve(a.data[0]),e[1]=b[f].resolve(a.data[1]),a.findFitness(e)<a.lastBestFitness&&(c=a.findFitness(e),d=b[f].genome);a.lastBestFitness=c,a.lastBestGenome=d,a.generation++,console.log(a.generation,a.lastBestFitness,a.lastBestGenome)}},a.findFitness=function(b){for(var c=[],d=0,e=0;e<b[0].length;e++)d+=b[0][e];for(c.push(Math.abs(d/b[0].length-a.expects[0])),d=0,e=0;e<b[1].length;e++)d+=b[1][e];return c.push(Math.abs(d/b[1].length-a.expects[1])),(c[0]+c[1])/2},a.generateGenome=function(){for(var b=a.lastBestGenome,c=0;100>c;c++)Math.random()<=a.mutationRate&&(b=replaceAt(b,c,Math.floor(6*Math.random()).toString()));return b}}SL=sugarLab;var SCREEN_SIZE=new SL.Vec2(800,600);